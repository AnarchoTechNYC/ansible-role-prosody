# This Ansible playbook runs test plays to ensure the role works.
---
- name: Test role.
  hosts: all
  become: true

  vars_files:
    - vars.yml

  pre_tasks:
    - name: Install netcat.
      package:
        name: netcat
        state: present

  roles:
    - ansible-role-prosody
    - tor
  
  tasks:
    - name: Configure Prosody TLS certificate.
      when: ansible_nodename | replace('.invalid', '') == item | replace('.invalid', '')
      include_tasks: prosody-tls.yml
      loop:
        - s1.invalid
        - s2.invalid
